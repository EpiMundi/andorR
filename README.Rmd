---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# andorR

<!-- badges: start -->
<!-- badges: end -->

[![R-CMD-check](https://github.com/EpiMundi/andorR/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/EpiMundi/andorR/actions/workflows/R-CMD-check.yaml)
`andorR` (pronounced ‘Andorra’) is an R package for the analysis and optimization of expert system AND-OR decision trees. It helps manage the process of gathering evidence and reaching conclusions under uncertainty, aiming to minimize resource use and maximize confidence.

## About

AND-OR decision trees (also known as logic trees or Boolean decision trees) provide a structured way to implement expert systems in domains where repeatable, transparent, and standardized decision processes are critical, and where multiple pathways may lead to the same conclusion. Such trees are particularly valuable when decisions are based on a set of binary (TRUE/FALSE) criteria that can be combined using AND and OR logic.

Examples include **clinical diagnosis of complex or ambiguous diseases** (e.g., *Ottawa Ankle Rules*, *Centor criteria*, *Alvarado score*), **transparent policy decisions** (e.g., criteria for listing notifiable animal diseases by WOAH or selecting World Heritage sites by UNESCO), and **finance and investment management** (e.g., stage-gate systems and exclusionary screening).

In each case, determining an accurate answer to each criterion (a leaf in the tree) can require considerable resources (expensive tests, detailed research, extensive data collection). `andorR` addresses a critical gap for R users by:

1.  **Optimizing the path to a conclusion:** It calculates the "influence index" for each unanswered question, guiding the user to the most efficient sequence to reach a decision.
2.  **Managing uncertainty:** It propagates semi-quantitative confidence scores through the tree's logic, allowing for an overall confidence in the conclusion.
3.  **Guiding evidence generation:** For a partially resolved tree, it identifies which low-confidence answers are most critical to strengthen through further investigation to boost confidence in the final result.

While the R ecosystem has excellent packages for machine-learning-derived decision trees (e.g., `rpart`), `andorR` specifically caters to the interactive, evidence-gathering workflow of expert-defined logic trees, making complex decision processes transparent, reproducible, and resource-efficient.

## Installation

You can install `andorR` directly from GitHub:

```r
# install.packages("remotes") # If you don't have remotes installed
remotes::install_github("epimundi/andorR")
```

## Example Usage

Let's illustrate `andorR`'s core functionality by loading a predefined ethical investment decision tree, making some initial decisions, and then identifying the most influential remaining questions.

First, load the package and an example tree, and view the tree structure.

```{r basic-example, eval = TRUE}
library(andorR)
library(knitr)

# Load the example 'ethical' dataset
data(ethical)
tree <- load_tree_df(ethical)

# Initially, the tree is unresolved
print_tree(tree)
```

Get a list of the questions:

```{r basic-example-print-questions, eval = TRUE}
questions_df <- print_questions(tree)

display_df <- questions_df[, c("name", "question")]
colnames(display_df) <- c("ID", "Question")

kable(
  display_df,
  caption = "Ethical investment decision tree questions", 
  align = 'l',
  escape = TRUE,
  booktabs = TRUE
) 
```

Answer some questions

```{r basic-example-set-answer, eval = TRUE}

tree <- set_answer(tree, "FIN1", TRUE, 4) # Company shows consistent, high revenue growth (high confidence)
tree <- set_answer(tree, "ENV2", FALSE, 3) # Waste and water usage are NOT minimal (medium confidence)

# Update the tree to propagate answers and calculate influence indices
tree <- update_tree(tree)

# Print the updated tree
print_tree(tree)
```

Now that some questions are answered and the tree is updated, we can find the most influential remaining questions to answer to efficiently reach a conclusion. In this case we are sorting by "TRUE", a 'rule-in' approach which ranks influence assuming we respond TRUE. The other options are "FALSE" ('rule-out') and "BOTH" (unopinionated). 

```{r basic-example-get-influence, eval = TRUE}
# Get the top 10 most influential unanswered questions
highest_influence_questions <- get_highest_influence(tree, sort_by = "TRUE", top_n = 10)

display_df <- highest_influence_questions[, c("name", "influence_if_true", "influence_if_false", "question")]
colnames(display_df) <- c("ID", "Inf True", "Inf False", "Question")

kable(
  display_df,
  caption = "Priority questions based on 'rule-in' strategy", 
  align = 'l',
  escape = TRUE,
  booktabs = TRUE
) 

```

This output helps users prioritize their next steps in gathering evidence.

### Interactive tool

The `andorR_interactive()` function chains these actions together in a CLI interactive loop to automate the process. 

## API Documentation

Detailed documentation for all functions and their arguments can be found in the package's reference manual. You can access it in R using `?function_name` (e.g., `?update_tree`) or by visiting the `andorR` pkgdown website (xxx pending xxx).

## Community Guidelines

We welcome contributions, bug reports, and feature requests. Please follow these guidelines:

  * **Contributing:** If you'd like to contribute code, please open an issue first to discuss your proposed changes. Then, fork the repository, make your changes, and submit a pull request.
  * **Reporting Issues:** If you encounter any bugs or have suggestions for improvements, please open an issue on the [GitHub Issues page](https://github.com/EpiMundi/andorR/issues). Please provide a minimal reproducible example if reporting a bug.
  * **Seeking Support:** For questions about using `andorR` or for general support, you can also open an issue on the [GitHub Issues page](https://github.com/EpiMundi/andorR/issues).
